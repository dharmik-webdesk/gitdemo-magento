<?php
/**
 * Top menu for store
 *
 * @var $block \Magento\Theme\Block\Html\Topmenu
 */
?>
<?php $columnsLimit = $block->getColumnsLimit() ?: 0; ?>
<?php $_menu = $block->getHtml('level-top', 'submenu', $columnsLimit) ?>

<nav class="navigation" id="SideCategoryList">

    <ul class="sf-menu sf-horizontal sf-js-enabled">
        <?php /* @escapeNotVerified */ echo $_menu; ?>
        <?php /* @escapeNotVerified */ echo $block->getChildHtml(); ?>
    </ul>

</nav>


<script type="text/javascript">
require([ 'jquery','domReady','js/masonry'],function($, domReady, Masonry){ 

$('#SideCategoryList ul li ul').each(function(){
	$(this).parent().addClass('parent');
	$('.parent ul li ul').parent().removeClass('parent');
	$('.parent ul li ul').parent().addClass('grand_child');
});

$('#SideCategoryList  ul:nth-child(3) > li:nth-of-type(1) .custom_sub_menu .custom_sub_menu_wi > ul:nth-child(2) > li:nth-of-type(1)').addClass('FirstAR');
$('#SideCategoryList  ul:nth-child(3) > li:nth-of-type(1) .custom_sub_menu .custom_sub_menu_wi > ul:nth-child(2) > li.FirstAR').empty();
$('#SideCategoryList  ul:nth-child(3) > li:nth-of-type(1) .custom_sub_menu .custom_sub_menu_wi > ul:nth-child(2) > li.FirstAR').css({"margin": "0px", "padding": "0px"});
$('.custom_sub_menu_wi > ul > li').addClass('megamenu');

$('#SideCategoryList > ul.sf-horizontal > li').each(function(){
	if($(this).find("ul").length>4){
		$(this).addClass('multi_ul_list');
	}else if ($(this).find("ul").length>=2){
		$(this).addClass('multi_ul_list');
		$(this).addClass('multi_ul_list_with_two_row');
	}
});

var totwidth=$('#SideCategoryList ul.sf-horizontal').css('width');
$('#SideCategoryList > ul.sf-horizontal > li').hover(function(){
	var total_menu_width= eval($('#SideCategoryList > ul.sf-horizontal').width());
	var dubug;
	var p = $(this);
	var position = p.position()
	var dubmenu= eval($(this).find('.custom_sub_menu').width());
	var menu_left_pos=eval(position.left);
	var current_menu_width=(eval($(this).width()))/2;
	menu_left= menu_left_pos;
	if($(this).find('.custom_sub_menu ul').hasClass('submenu')){
		$(this).find('.custom_sub_menu').show();
		$(this).addClass('hover');		
	}
	var middle_pos=dubmenu/2;
	menu_left=middle_pos;
	var outerlimit=menu_left-menu_left_pos;
	
	if(outerlimit>0){
		 menu_left=menu_left-outerlimit;
	}else{
		dubug='Get Poistion'+((middle_pos+menu_left_pos)+'-Poistion-'+total_menu_width+'-current_menu_width-'+current_menu_width);	
		if((middle_pos+menu_left_pos+current_menu_width)>total_menu_width){
			var outerlimit=total_menu_width-(middle_pos+menu_left_pos+current_menu_width);
			menu_left=menu_left-(outerlimit);
		}
		
	}
	$(this).find('.custom_sub_menu').css('left','-'+menu_left+'px');
	
	if($(this).hasClass('multi_ul_list')){
		var elem = document.querySelector('li.hover.multi_ul_list .custom_sub_menu .custom_sub_menu_wi > ul');
		var msnry = new Masonry( elem, {
        itemSelector: '.megamenu'
 		});
 	}
},function(){
	$(this).find('.custom_sub_menu').hide();
	$(this).removeClass('hover');
});
});
</script>
<style>
.sections.nav-sections .navigation>ul>li {
    position:relative;}
.sections.nav-sections .navigation>ul>li .custom_sub_menu{ left: 0px}
</style>